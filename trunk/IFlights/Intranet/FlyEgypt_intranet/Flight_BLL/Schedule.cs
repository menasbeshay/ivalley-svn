
// Generated by MyGeneration Version # (1.3.0.3)

using System;
using Flight_DAL;
namespace Flight_BLL
{
	public class Schedule : _Schedule
	{
		public Schedule()
		{
		
		}

        public bool GetAllSchedules()
        {
            return LoadFromRawSql(@"select M.*, U.username UpdatedByName , C.username CreatedByName ,
                                    (Select Top 1 path from scheduleVersion MV where MV.scheduleID = M.scheduleID Order by MV.LastUpdatedDate desc) VersionPath       
                                    from schedule M
                                    Left join aspnet_users U on M.UpdatedBy = U.UserID
                                    Left join aspnet_users C on M.CreatedBy = C.UserID                                    
                                    order by CreatedDate desc");  
        }

        public virtual bool GetManualsByCatID(int CatID, Guid UserID)
        {
            return LoadFromRawSql(@"select M.*, U.username UpdatedByName , C.username CreatedByName ,-- ,sum(case when UMV.UserNotificationID is not null then 1 else 0 end) ManualVersionUpdates ,
                                    (Select Top 1 path from ManualVersion MV where MV.ManualID = M.ManualID Order by MV.LastUpdatedDate desc) VersionPath   ,
                                    /*(select isnull(sum(case when UM.UserNotificationID is not null then 1 else 0 end),0)  from UsersNofications UM where M.ManualID = UM.ManualID and 
								                                     UM.FormID is null and 
								                                     UM.ManualVersionID is null and 
								                                     UM.FromVersionID is null and 
								                                     (UM.IsRead is null OR UM.IsRead <> 1) and
								                                     UM.UserID = {1}) ScheduleUpdates, 
                                    (select isnull(sum(case when UMV.UserNotificationID is not null then 1 else 0 end),0)  from UsersNofications UMV where M.ManualID = UMV.ManualID and 
								                                     UMV.FormID is null and 								 
								                                     UMV.FromVersionID is null and 
								                                     UMV.ManualVersionID is not null and
								                                     (UMV.IsRead is null OR UMV.IsRead <> 1) and
								                                     UMV.UserID = {1}) ScheduleVersionUpdates	*/								 								    
                                    from schedule M
                                    Left join aspnet_users U on M.UpdatedBy = U.UserID
                                    Left join aspnet_users C on M.CreatedBy = C.UserID     
                                    where ManualCategoryID = {0} 

                                    order by CreatedDate desc", CatID, UserID);
        }
	}
}
