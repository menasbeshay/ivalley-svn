
// Generated by MyGeneration Version # (1.3.0.3)

using System;
using System.Collections.Specialized;
using System.Data;
using System.Data.SqlClient;
using DAL;
namespace BLL
{
    public class MemberMessage : _MemberMessage
    {
        public MemberMessage()
        {

        }

        public virtual bool LoadSentMessages(int MemberID)
        {
            return LoadFromRawSql(@"Select MemberMessage.*,Message.*
                                    from MemberMessage INNER JOIN Message on Message.ID=MemberMessage.MessageID AND MemberMessage.MemberID IS NULL
                                    where Message.SenderID = {0} And (IsDeleted is null Or IsDeleted <> 1) AND MessageFolderID IS NULL
                                    Order by CreateDate desc", MemberID);

        }

        public virtual bool LoadReceivedMessages(int MemberID)
        {
            ListDictionary parameters = new ListDictionary();
            
            return LoadFromRawSql(@"Select MemberMessage.*,Message.*,[FromMember]=Member.Name 
                                    from MemberMessage INNER JOIN Message on Message.ID=MemberMessage.MessageID
                                                       INNER JOIN Member ON Member.MemberID=Message.SenderID
                                    where MemberMessage.MemberID = {0} And 
	                                      (IsDeleted is null Or IsDeleted <> 1) AND MessageFolderID IS NULL
                                    Order by CreateDate desc", MemberID);
        }

        public virtual bool LoadTrashMessages(int MemberID)
        {
            return LoadFromRawSql(@"Select MemberMessage.*,Message.*,[FromMember]=Member.Name 
                                    from MemberMessage INNER JOIN Message on Message.ID=MemberMessage.MessageID
                                                       INNER JOIN Member ON Member.MemberID=Message.SenderID
                                    where (MemberMessage.MemberID = {0} OR (Message.SenderID={0} AND MemberMessage.MemberID IS NULL))  And
	                                  IsDeleted = 1 AND MessageFolderID IS NULL
                                Order by CreateDate desc", MemberID);

        }

        public virtual bool LoadByFolderID(int FolderID)
        {
            return LoadFromRawSql(@"Select MemberMessage.*,Message.*,[FromMember]=Member.Name 
                                    from MemberMessage INNER JOIN Message on Message.ID=MemberMessage.MessageID
                                                       INNER JOIN Member ON Member.MemberID=Message.SenderID
                                where MemberMessage.MessageFolderID = {0}
                                Order by CreateDate desc", FolderID);

        }

        public void MoveToFolder(System.Collections.Generic.List<int> selectedMessages, int folderID)
        {
            if (selectedMessages != null && selectedMessages.Count > 0)
            {
                this.Where.ID.Value = String.Join(",", selectedMessages);
                this.Where.ID.Operator = MyGeneration.dOOdads.WhereParameter.Operand.In;
                if (this.Query.Load())
                {
                    do
                    {
                        this.MessageFolderID = folderID;
                        this.IsDeleted = false;
                    } while (this.MoveNext());
                    this.Save();
                }
            }
        }

        public void MoveToTrash(System.Collections.Generic.List<int> selectedMessages)
        {
            if (selectedMessages != null && selectedMessages.Count > 0)
            {
                this.Where.ID.Value = String.Join(",", selectedMessages);
                this.Where.ID.Operator = MyGeneration.dOOdads.WhereParameter.Operand.In;
                if (this.Query.Load())
                {
                    do
                    {
                        this.IsDeleted = true;
                        this.SetColumnNull(MemberMessage.ColumnNames.MessageFolderID);
                    } while (this.MoveNext());
                    this.Save();
                }
            }
        }

        public void Delete(System.Collections.Generic.List<int> selectedMessages)
        {
            if (selectedMessages != null && selectedMessages.Count > 0)
            {
                this.Where.ID.Value = String.Join(",", selectedMessages);
                this.Where.ID.Operator = MyGeneration.dOOdads.WhereParameter.Operand.In;
                if (this.Query.Load())
                {
                    do
                    {
                        this.MarkAsDeleted();
                    } while (this.MoveNext());
                    this.Save();
                }
            }
        }

        public bool LoadFullInfoByID(int msgID)
        {
            return LoadFromRawSql(@"Select MemberMessage.*,Message.*,[FromMember]=Member.Name 
                                    from MemberMessage INNER JOIN Message on Message.ID=MemberMessage.MessageID
                                                       INNER JOIN Member ON Member.MemberID=Message.SenderID
                                    WHERE MemberMessage.ID={0}
                                Order by CreateDate desc", msgID);
        }

        public override bool IsRead
        {
            get
            {
                if (IsColumnNull(ColumnNames.IsRead))
                    return false;
                return base.IsRead;
            }
            set
            {
                base.IsRead = value;
            }
        }
        public override bool IsDeleted
        {
            get
            {
                if (IsColumnNull(ColumnNames.IsDeleted))
                    return false;
                return base.IsDeleted;
            }
            set
            {
                base.IsDeleted = value;
            }
        }
    }
}
