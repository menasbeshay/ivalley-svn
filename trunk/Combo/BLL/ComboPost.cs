
// Generated by MyGeneration Version # (1.3.0.3)

using System;
using Combo.DAL;
namespace Combo.BLL
{
	public class ComboPost : _ComboPost
	{
		public ComboPost()
		{
		
		}

        // get user posts - shared posts - friends posts - following posts
        public virtual bool GetPostByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null) 
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P                                                                        
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID 
                                    Inner join ComboPostShare PS on PS.ComboPostID = P.ComboPostID and 
																	PS.ComboUserID = {0}
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and															   
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
									Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Where (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboUserID in (select ComboFollowerID from ProfileFollower PF where PF.ComboUserID = {0}) and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    inner join ComboUserFriend CF on U.ComboUserID = CF.ComboFriendID and 
								                                     CF.ComboUserID = {0} and 
                                                                     CF.RequestApproved = 1	and 
                                                                     (CF.IsBanned <> 1 or CF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)

                                    union 
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner join ComboUserFriend CFF on U.ComboUserID = CFF.ComboUserID and
								                                      CFF.ComboFriendID = {0} and
                                                                      CFF.RequestApproved = 1 and
                                                                      (CFF.IsBanned <> 1 or CFF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetUserPostByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                                                         
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetPhotoPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner Join ComboPostAttachment PA on P.ComboPostID = PA.ComboPostID
                                    inner Join Attachment AA on PA.AttachmentID = AA.AttachmentID and 
                                                                AA.AttachmentTypeID = 1 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                     
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetAudioPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner Join ComboPostAttachment PA on P.ComboPostID = PA.ComboPostID
                                    inner Join Attachment AA on PA.AttachmentID = AA.AttachmentID and 
                                                                AA.AttachmentTypeID = 2 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                     
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetVedioPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner Join ComboPostAttachment PA on P.ComboPostID = PA.ComboPostID
                                    inner Join Attachment AA on PA.AttachmentID = AA.AttachmentID and 
                                                                AA.AttachmentTypeID = 3 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                     
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetTextPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    left outer Join ComboPostAttachment PA on P.ComboPostID = PA.ComboPostID                                                                           
                                    Where P.ComboUserID = {0} and PA.ComboPostID is null and
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                     
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetLikedPostByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)                                    
                                    Inner Join ComboPostLike PL on PL.ComboPostID = P.ComboPostID and 
							                                       PL.ComboUserID = {0}
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where (P.IsDeleted <> 1 or P.IsDeleted is null) 
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetFollowingPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboUserID in (select ComboFollowerID from ProfileFollower PF where PF.ComboUserID = {0}) and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetFriendsPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    inner join ComboUserFriend CF on U.ComboUserID = CF.ComboFriendID and 
								                                     CF.ComboUserID = {0} and 
                                                                     CF.RequestApproved = 1	and 
                                                                     (CF.IsBanned <> 1 or CF.IsBanned is null)					 
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)

                                    union 
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner join ComboUserFriend CFF on U.ComboUserID = CFF.ComboUserID and
								                                      CFF.ComboFriendID = {0} and
                                                                      CFF.RequestApproved = 1 and
                                                                      (CFF.IsBanned <> 1 or CFF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetPostByID(int pid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboPostID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)", pid);
        }

        public virtual bool SearchPosts(string filterText, int requester)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboUserID in (select ComboFollowerID from ProfileFollower PF where PF.ComboUserID = {1}) and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null) and P.PostText like '%' + {0} + '%' 
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    inner join ComboUserFriend CF on U.ComboUserID = CF.ComboFriendID and 
								                                     CF.ComboUserID = {1} and 
                                                                     CF.RequestApproved = 1	and 
                                                                     (CF.IsBanned <> 1 or CF.IsBanned is null)
                                    where P.PostText like '%' + {0} + '%' and (P.IsDeleted <> 1 or P.IsDeleted is null)

                                    union 
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner join ComboUserFriend CFF on U.ComboUserID = CFF.ComboUserID and
								                                      CFF.ComboFriendID = {1} and
                                                                      CFF.RequestApproved = 1 and
                                                                      (CFF.IsBanned <> 1 or CFF.IsBanned is null)
                                    where P.PostText like '%' + {0} + '%' and  (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.PostText like '%' + {0} + '%' and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null) ", filterText, requester);
        }

        public virtual bool ExplorePosts()
        {
            return LoadFromRawSql(@"select P.* , U.UserName, A.Path ProfilePic, S.IsPostsDownloadable,
                                    (select COUNT(c.ComboCommentID) 
                                     from ComboComment C where P.ComboPostID = C.ComboPostID)  commentCount
                                    ,(select COUNT(pl.ComboPostID) LikeCount 
                                    from ComboPostLike PL where P.ComboPostID = PL.ComboPostID ) Likecount
                                    from ComboPost P Inner Join ComboUser U on P.ComboUserID = U.ComboUserID
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    order by Likecount desc, commentCount desc , PostDate desc ");
        }

	}
}
