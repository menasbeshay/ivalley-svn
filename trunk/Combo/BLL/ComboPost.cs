
// Generated by MyGeneration Version # (1.3.0.3)

using System;
using Combo.DAL;
namespace Combo.BLL
{
	public class ComboPost : _ComboPost
	{
		public ComboPost()
		{
		
		}

        // get user posts - shared posts - friends posts - following posts
        public virtual bool GetPostByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null) 
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID 
                                    Inner join ComboPostShare PS on PS.ComboUserID = {0}
                                    Where (P.IsDeleted <> 1 or P.IsDeleted is null) 
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboUserID in (select ComboFollowerID from ProfileFollower PF where PF.ComboUserID = {0}) and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    union
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    inner join ComboUserFriend CF on U.ComboUserID = CF.ComboFriendID and 
								                                     CF.ComboUserID = {0} and 
                                                                     CF.RequestApproved = 1	and 
                                                                     (CF.IsBanned <> 1 or CF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)

                                    union 
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner join ComboUserFriend CFF on U.ComboUserID = CFF.ComboUserID and
								                                      CFF.ComboFriendID = {0} and
                                                                      CFF.RequestApproved = 1 and
                                                                      (CFF.IsBanned <> 1 or CFF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetPhotoPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner Join ComboPostAttachment PA on P.ComboPostID = PA.ComboPostID
                                    inner Join Attachment AA on PA.AttachmentID = AA.AttachmentID and 
                                                                AA.AttachmentTypeID = 1 
                                    Where P.ComboUserID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)                                     
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetLikedPostByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)                                    
                                    Inner Join ComboPostLike PL on PL.ComboPostID = P.ComboPostID and 
							                                       PL.ComboUserID = {0}
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where (P.IsDeleted <> 1 or P.IsDeleted is null) 
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetFollowingPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic , S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and 
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboUserID in (select ComboFollowerID from ProfileFollower PF where PF.ComboUserID = {0}) and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetFriendsPostsByUserID(int userid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    inner join ComboUserFriend CF on U.ComboUserID = CF.ComboFriendID and 
								                                     CF.ComboUserID = {0} and 
                                                                     CF.RequestApproved = 1	and 
                                                                     (CF.IsBanned <> 1 or CF.IsBanned is null)					 
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)

                                    union 
                                    Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable 
                                    from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID and
                                                              (U.IsDeactivated <> 1 or U.IsDeactivated is null)
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Inner join ComboUserFriend CFF on U.ComboUserID = CFF.ComboUserID and
								                                      CFF.ComboFriendID = {0} and
                                                                      CF.RequestApproved = 1 and
                                                                      (CF.IsBanned <> 1 or CF.IsBanned is null)
                                    where (P.IsDeleted <> 1 or P.IsDeleted is null)
                                    order by P.PostDate Desc", userid);
        }

        public virtual bool GetPostByID(int pid)
        {
            return LoadFromRawSql(@"Select P.*, U.UserName, A.Path ProfilePic, S.IsPostsDownloadable from ComboPost P
                                    Inner Join ComboUser U on P.ComboUserID = U.ComboUserID
                                    Left join Attachment A on U.ProfileImgID = A.AttachmentID
                                    Left join ComboUserSettings S on P.ComboUserID = S.ComboUserID
                                    Where P.ComboPostID = {0} and 
                                    (P.IsDeleted <> 1 or P.IsDeleted is null)", pid);
        }

	}
}
